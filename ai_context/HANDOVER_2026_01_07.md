# AI Handover Document - 7 January 2026

## Current State

### What Was Just Fixed
1. **Dashboard welcome modal button** - Changed "See how it works" → "Explore Features" linking to `/features` instead of `/how-it-works` (file: `app/dashboard/page.tsx` line ~284-290)

2. **Demo mode prompt input** - Fixed GuestPromptModal not being used. Was using InlinePromptInput which got blocked by flex/overflow. Now properly imports and renders GuestPromptModal for demo mode (file: `components/SectionBuilder.tsx`)

3. **Modal sizes** - Shrunk BuilderWelcome, DemoWelcome, WelcomeModal from max-w-md to max-w-xs/sm for mobile

### Commits Made (all pushed to origin/main)
- `b7ce059` - Mobile tightening: compact layouts
- `b074406` - Shrink modals: compact sizes for mobile  
- `4d0cc15` - Fix: Use GuestPromptModal overlay for demo mode
- `286beb0` - chore: update next-env types
- Plus the "Explore Features" button change (uncommitted)

---

## CRITICAL ISSUE: Production Environment Variables

### Root Cause of Production Errors
Clerk redirect URLs in Vercel env vars point to NON-EXISTENT route:
```
NEXT_PUBLIC_CLERK_SIGN_IN_FALLBACK_REDIRECT_URL=/dashboard/studio  ❌ WRONG
NEXT_PUBLIC_CLERK_SIGN_UP_FALLBACK_REDIRECT_URL=/dashboard/studio  ❌ WRONG
```

### Fix Required (User must do in Vercel dashboard)
Change both to:
```
NEXT_PUBLIC_CLERK_SIGN_IN_FALLBACK_REDIRECT_URL=/dashboard  ✅
NEXT_PUBLIC_CLERK_SIGN_UP_FALLBACK_REDIRECT_URL=/dashboard  ✅
```
Then redeploy.

The `/dashboard/studio` route does NOT exist. Dashboard folder only contains:
- `billing/`
- `layout.tsx`
- `page.tsx`
- `projects/`

---

## Current Bug Being Debugged

### Issue
Clicking "Start Building" on dashboard welcome modal throws:
```
[Dashboard] Create project failed: {}
```
at `app/dashboard/page.tsx:127`

### Analysis
- The `{}` indicates `res.status` was undefined
- This means the fetch itself failed (network error, not API error)
- API route at `/api/project/route.ts` looks correct
- Likely cause: Dev server instability or auth session not being passed

### Next Steps to Debug
1. Check browser Network tab when clicking button - see actual request/response
2. Check terminal for server-side errors
3. Verify dev server is running: `npm run dev`
4. Try hard refresh of localhost:3000

---

## Key Files Reference

| File | Purpose |
|------|---------|
| `app/dashboard/page.tsx` | Dashboard with welcome modal, project list |
| `app/api/project/route.ts` | POST endpoint to create projects |
| `components/SectionBuilder.tsx` | Main builder UI, renders GuestPromptModal for demo |
| `components/GuestPromptModal.tsx` | Cinematic prompt modal for guests (fixed z-50 overlay) |
| `components/WelcomeModal.tsx` | Signup gate modal |
| `components/BuilderWelcome.tsx` | Builder welcome for auth users |
| `components/DemoWelcome.tsx` | Demo mode welcome |

---

## Stack
- Next.js 16.1.1 (Turbopack)
- React 19
- Clerk for auth
- Supabase for DB
- Tailwind 4
- Framer Motion
- Deployed on Vercel

---

## Uncommitted Changes
```
app/dashboard/page.tsx - "Explore Features" button change
```

Run `git add -A && git commit -m "Change dashboard CTA to Explore Features"` to commit.
